<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8" />
		<title>运动赛事管理信息系统</title>
		<meta name="keywords" content="" />
		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="assets/css/font-awesome.min.css" />
		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300" />
		<link rel="stylesheet" href="assets/css/ace.min.css" />
		<link rel="stylesheet" href="assets/css/ace-rtl.min.css" />
		<link rel="stylesheet" href="assets/css/ace-skins.min.css" />
		<script src="assets/js/ace-extra.min.js"></script>
		<script src="assets/js/myjs/my.js"></script>


		<style>
			.page-content .left img {
				width: 100%;
				position:fixed;
				height: 500px;
			}

			/*弹框*/
			html{height: 100%;}
			body{position: relative;height: 100%;}
			.dialogbody{position: absolute;z-index: 999;width: 100%;height: 100%;background: rgba(0,0,0,.8);top: 0;left: 0;display: none;}
			.dialogbox{position: absolute;display: block;width: 800px;height: 600px;background: #fff;border-radius: 15px;top: 0;left: 0;right: 0;bottom: 0;margin: auto;}
			.dialogbox .close{position: absolute;display: block;width: 50px;height: 50px;background: url(assets/images/Close.png) no-repeat 100% center;top: 20px;right: 20px;}

			#pagination{
				margin: 0 auto;
				text-align:center;
			}

			.ui{
				width:700px;
				height:50px;
				list-style: none;
				padding:0;
			}
			.ui li{
				width:70px;
				float: left;/*该处换为display:inline-block;同样效果*/

			}

			.ui li a{
				width:70px;
				height:50px;
				/*padding:0 20px;*/
				font-size: 12px;
				line-height:50px;
				display: inline;
			}
		</style>
	</head>
	<body>
		<!--头部 Begin-->
		<div class="navbar navbar-default" id="navbar">
			<script type="text/javascript">
				try {
					ace.settings.check('navbar', 'fixed')
				} catch(e) {}
			</script>

			<div class="navbar-container" id="navbar-container">
				<div class="navbar-header pull-left">
					<a href="#" class="navbar-brand">
						<small>
							<i class="icon-leaf"></i>
							运动赛事管理信息系统
						</small>
					</a>
				</div>

				<div class="navbar-header pull-right" role="navigation">
					<ul class="nav ace-nav">
						<li class="light-blue">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo" />
								<span class="user-info">
									<small>欢迎光临</small>
									<strong id="username"></strong>

								</span>

								<i class="icon-caret-down"></i>
							</a>

							<ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
								<li>
									<div class="col-sm-offset-2 col-sm-10">
										<i class="icon-off"></i>
										<button type="button" onclick="logout()" class="btn btn-default">退出</button>
									</div>
								</li>
							</ul>
						</li>
					</ul>
					<!-- /.ace-nav -->
				</div>
				<!-- /.navbar-header -->
			</div>
			<!-- /.container -->
		</div>
		<!--头部 End-->

		<!--主体部分 Begin-->
		<div class="main-container" id="main-container">
			<script type="text/javascript">
				try {
					ace.settings.check('main-container', 'fixed')
				} catch(e) {}
			</script>

			<div class="main-container-inner">
				<a class="menu-toggler" id="menu-toggler" href="#">
					<span class="menu-text"></span>
				</a>

				<!--左侧导航 Begin-->
				<div class="sidebar" id="sidebar">
					<script type="text/javascript">
						try {
							ace.settings.check('sidebar', 'fixed')
						} catch(e) {}
					</script>

					<ul class="nav nav-list" id="navlist">
						<li class="active navshowa">
							<a href="index.html">
								<i class="icon-dashboard"></i>
								<span class="menu-text">首页</span>
							</a>
						</li>

						<li class="active navshowa1">
							<a href="project.html">
								<i class="icon-text-width"></i>
								<span class="menu-text">赛事管理</span>
								<b class="arrow icon-angle-down"></b>
							</a>

							<ul class="submenu">
								<li class="navshowa21">
									<a href="sub_project.html">
										<i class="icon-double-angle-right"></i> 项目管理
									</a>
								</li>
							</ul>
						</li>

						<li class="active navshowa2">
							<a href="#" class="dropdown-toggle">
								<i class="icon-desktop"></i>
								<span class="menu-text">成绩查询</span>

								<b class="arrow icon-angle-down"></b>
							</a>

							<ul class="submenu">
								<li class="navshowa21">
									<a href="search_person.html">
										<i class="icon-double-angle-right"></i> 状态查询
									</a>
								</li>

								<!--<li class="navshowa22">
									<a href="search_school.html">
										<i class="icon-double-angle-right"></i> 团队查询
									</a>
								</li>-->
							</ul>
						</li>

						<li class="active navshowa3">
							<a href="#" class="dropdown-toggle">
								<i class="icon-list"></i>
								<span class="menu-text">报名管理</span>

								<b class="arrow icon-angle-down"></b>
							</a>

							<ul class="submenu">
								<li class="navshowa31">
									<a href="enter.html">
										<i class="icon-double-angle-right"></i> 报名
									</a>
								</li>

								<li class="navshowa32">
									<a href="enter_msg.html">
										<i class="icon-double-angle-right"></i> 报名信息查询
									</a>
								</li>
							</ul>
						</li>

						<li class="active navshowa4">
							<a href="addscore.html" class="dropdown-toggle">
								<i class="icon-edit"></i>
								<span class="menu-text">成绩录入</span>
							</a>
						</li>

						<li class="active navshowa5">
							<a href="usermsg.html" class="dropdown-toggle">
								<i class="icon-apple"></i>
								<span class="menu-text">权限管理</span>
							</a>
						</li>
					</ul>
					<!-- /.nav-list -->
				</div>
				<!--左侧导航 End-->

				<!--右侧内容 Begin-->
				<div class="main-content">
					<!--面包屑导航 Begin-->
					<div class="breadcrumbs" id="breadcrumbs">
						<script type="text/javascript">
							try {
								ace.settings.check('breadcrumbs', 'fixed')
							} catch(e) {}
						</script>

						<ul class="breadcrumb">
							<li>
								<i class="icon-home home-icon"></i>
								<a href="index.html" class="active">首页</a>
							</li>
						</ul>
					</div>
					<!--面包屑导航 End-->

					<!--内容 Begin-->
					<div class="page-content">
						<div class="row">
							<div class="col-xs-12">
								<h3 class="header smaller lighter blue">
									比赛进度查询
								</h3>
								<!--输入框 Begin-->
								<form class="form-horizontal" role="form">

									<div class="form-group">

										<div class="input-group-btn">

											<label class="col-sm-4 control-label no-padding-right" for="form-field-2">赛事</label>

											<div class="col-sm-4">
												<select id="gameType" placeholder="" class="col-xs-10 col-sm-5 form-control"
														name="gameType" >
												</select>
											</div>
										</div>

										<div class="input-group-btn">
											<label class="col-sm-4 control-label no-padding-right" for="form-field-1">状态</label>

											<div class="col-sm-4">
												<select id="status" placeholder="" class="col-xs-10 col-sm-5 form-control"
														name="status">
													<option value="0">待打印</option>
													<option value="1">进行中</option>
													<option value="2">已结束</option>
												</select>
											</div>
										</div>

										<!--<div class="col-sm-4">

										</div>-->
									</div>
								</form>

								<button class="btn btn-info dialogalert"  type="button" style="float:right" onclick="doSearch()">
									查询
									<i class="icon-search  align-top bigger-125 icon-on-search"></i>
								</button>
								<div></div>
								<button class="btn btn-info dialogalert"  type="button" style="float:right" onclick="doPrint()">
									导出
									<i class="icon-download  align-top bigger-125 icon-on-search"></i>
								</button>

								<!--输入框 End-->
								
								<!--查询后显示 Begin-->
								<div class="table-responsive" style="height:400px;">
									<table id="table" class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th class="center">项目代码</th>
												<th class="center">项目名称</th>
												<th class="hidden-480">名单预览</th>
											</tr>
										</thead>
										
										<tbody>

										</tbody>
									</table>
								</div>

								<!--查询后显示 End-->
							</div>
						</div>
					</div>

					<div id="pagination">

						<div class="space-4"></div>

						<span id="summary"></span>

						<ul class="ui">

							<li id="01"><a onclick="index()" style="font-size: 5px">首页</a></li>

							<li id="02"><a onclick="last()" style="font-size: 5px" >上一页</a></li>

							<li id="03"><a onclick="next()" style="font-size: 5px">下一页</a></li>

							<li id="04"><a onclick="zuihou()" style="font-size: 5px">最后一页</a></li>
						</ul>
					</div>
					<!--内容 End-->
				</div>
				<!--右侧内容 End-->
			</div>
		</div>


		<!--弹框（Modal） -->
		<div class="dialogbody rank">
			<div class="dialogbox" style="height: 352px">
				<span class="close"></span>
				<div class="space-8"></div>
				<div class="row" style="padding-top: 50px;">
					<div class="col-xs-12">

						<div class="table-responsive" style="height:300px;overflow:auto; ">
							<table id="table2" class="table table-striped table-bordered table-hover" width="100%">
								<thead>
								<tr>
									<th>项目代码</th>
									<th>项目名称</th>
									<th>组别</th>
									<th>团队</th>
									<th class="hidden-480">姓名</th>
									<th>成绩</th>
									<th>名次</th>
								</tr>
								</thead>

								<tbody>

								</tbody>
							</table>
						</div>
					</div>


				</div>
			</div>
		</div>



		<script src="assets/js/jquery-2.0.3.min.js"></script>
		<script type="text/javascript">
			window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "script>");
		</script>
		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "script>");
		</script>
		<script src="assets/js/bootstrap.min.js"></script>
		<script src="assets/js/typeahead-bs2.min.js"></script>
		<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
		<script src="assets/js/jquery.slimscroll.min.js"></script>
		<script src="assets/js/jquery.easy-pie-chart.min.js"></script>
		<script src="assets/js/jquery.sparkline.min.js"></script>
		<script src="assets/js/flot/jquery.flot.min.js"></script>
		<script src="assets/js/flot/jquery.flot.pie.min.js"></script>
		<script src="assets/js/flot/jquery.flot.resize.min.js"></script>
		<script src="assets/js/ace-elements.min.js"></script>
		<script src="assets/js/ace.min.js"></script>
		<script src="assets/js/myjs/index.js"></script>

		<script type="text/javascript">
            window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "script>");
            if ("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "script>");
            $('.close').click(function(){
                $('.dialogbody').css({'display':'none'})
            })

		</script>

		<script type="text/javascript">
            window.onload = showGames();
            function showGames(){
                $.ajax({
                    type: "GET",//方法类型
                    contentType: "application/json",
                    dataType: "json",//预期服务器返回的数据类型
                    url: "/projectController/queryGameList",
                    async: false,
                    success: function (result) {
                        if (result.httpStatus == 200) {
                            var content = "";
                            var dataArr = result.data;
                            var nameOpt = "";
                            if(dataArr.length > 0){
                                nameOpt+="<option value='"+dataArr[0]+"' >"+dataArr[0]+"</option>"
                                for (var i = 1; i < dataArr.length; i++) {
                                    nameOpt+="<option value='"+dataArr[i]+"' >"+dataArr[i]+"</option>"
                                }
							}else{
								nameOpt = "<option value='' selected='selected'>--请选择--</option>";
							}
                            $('#gameType').html(nameOpt);
                        };
                    },
                    error: function () {
                        alert("异常！");
                    }
                })
            }
		</script>

		<script type="text/javascript">

            var gameName = document.getElementById("gameType").value;
            var status = document.getElementById("status").value;

            function doPrint() {
                var url = '/statusSerch/download';
                var xhr = new XMLHttpRequest();
                xhr.open('POST', url, true);        // 也可以使用POST方式，根据接口
                xhr.setRequestHeader('Content-Type', 'application/json;charset=utf-8');
                xhr.responseType = "blob";    // 返回类型blob
                // 定义请求完成的处理函数，请求前也可以增加加载框/禁用下载按钮逻辑
                xhr.onload = function () {
                    // 请求完成

                    if (this.status === 200) {

                        // 返回200

                        var blob = this.response;

                        var reader = new FileReader();

                        reader.readAsDataURL(blob);    // 转换为base64，可以直接放入a表情href

                        reader.onload = function (e) {

                            // 转换完成，创建一个a标签用于下载

                            var a = document.createElement('a');

                            a.download = 'data.xls';

                            a.href = e.target.result;

                            $("body").append(a);    // 修复firefox中无法触发click

                            a.click();

                            $(a).remove();

                        }

                    }

                };

                // 发送ajax请求

                xhr.send(JSON.stringify({
                    "gameName" : gameName,
                    "status" : status
                }));
                /*var gameName = document.getElementById("gameType").value;
                var status = document.getElementById("status").value;

                $.ajax({
                    type: "POST",
                    contentType: "application/json",
                    dataType: "json",
                    data:{gameName:gameName, status: status},
                    url: "/statusSerch/download",
                    async: false,
                    success: function (result) {
                        if (result.httpStatus == 200) {
                            alert("下载成功!");
                        };
                    },
                    error: function () {
                        alert("异常！");
                    }
                });*/
            }
		</script>

		<script type="text/javascript">

            function doSearch() {
                var gameName = document.getElementById("gameType").value;
                var status = document.getElementById("status").value;

                loadData(gameName, status, 1, 10);

                /*$.ajax({
                    type: "GET",
                    contentType: "application/json",
                    dataType: "json",
                    data:{gameName:gameName, status: status},
                    url: "/statusSerch/competition",
                    async: false,
                    success: function (result) {
                        if (result.httpStatus == 200) {
                            var content = "";
                            var dataArr = result.data.groupingProjectInfoS;
                            var competitionId = result.data.competitionId;
                            if(dataArr != null){
                                $.each(dataArr, function(index, item){
                                    content += "<tr>" +
                                        "<td class='center'>" + item.projectId+"</td>" +
                                        "<td class='hidden-480 center'>"+item.projectName+ "</td>" +
                                        "<td><div class='visible-md visible-lg hidden-sm hidden-xs action-buttons'>" +
                                        "<a class='green' onclick='doRank("+competitionId+", "+item.projectId+", "+status+")'>" +
                                        "<i class='icon-pencil bigger-130'></i></a></div></td>" +
                                    "</tr>";
                                });
							}
                            $("#table tbody").empty();
                            $("#table tbody").html(content);
                        };
                    },
                    error: function () {
                        alert("异常！");
                    }
                });*/
            }
		</script>

		<script type="text/javascript">
			function doRank(competitionId, projectId, status) {
			    if(status == 1){
			        alert("该比赛项目正在火热进行中，请稍后重试。。。。");
					return;
				}
                $('.dialogbody.rank').css({'display':'block'});
                console.log(competitionId + ", " + projectId);
                $.ajax({
                    type: "get",
                    dataType: "json",
                    async:'false',
                    url: "/statusSerch/rank",
                    data:{competitionId:competitionId,projectId:projectId},
                    success:function (res) {
                        if (res.httpStatus==200) {
                            var data = res.data;
                            var content = "";
                            for(var i = 0; i < data.length; i++){
                                var teamType = data[i].teamType;
                                var achievements = data[i].achievementDetailList;
                                if(achievements != null){
                                    $.each(achievements, function(index, item){
                                        content += "<tr>" +
                                            "<td>" + item.projectId+"</td>" +
                                            "<td>" + item.projectName+"</td>" +
                                            "<td>" + teamType+"</td>" +
                                            "<td>" + item.groupName+"</td>" +
                                            "<td>" + item.username+"</td>" +
                                            "<td>" + item.score+"</td>" +
                                            "<td>" + item.rank+"</td>" +
                                        "</tr>";
                                    });
                                }
                                $("#table2 tbody").empty();
                                $("#table2 tbody").html(content);
							}
                        }
                    }
                })
            }
		</script>


		<script type="text/javascript">

            var pageNo = 1;

            var pageSize = 10;

            var pages = 0;


            function loadData(gameName,status,pageNo,pageSize){
                $.ajax({
                    type: "GET",
                    contentType: "application/json",
                    dataType: "json",
                    data:{gameName:gameName, status: status, pageNum:pageNo,pageSize:pageSize},
                    url: "/statusSerch/competition",
                    async: false,

                    success:function(result){

                        if (result.httpStatus == 200) {
                            var content = "";
                            var dataArr = result.data.data.groupingProjectInfoS;
                            var competitionId = result.data.data.competitionId;
                            var totalCount = result.data.total;
							pages = result.data.pages;
                            if(dataArr != null){
                                $.each(dataArr, function(index, item){
                                    content += "<tr>" +
                                        "<td class='center'>" + item.projectId+"</td>" +
                                        "<td class='hidden-480 center'>"+item.projectName+ "</td>" +
                                        "<td><div class='visible-md visible-lg hidden-sm hidden-xs action-buttons'>" +
                                        "<a class='green' onclick='doRank("+competitionId+", "+item.projectId+", "+status+")'>" +
                                        "<i class='icon-pencil bigger-130'></i></a></div></td>" +
                                        "</tr>";
                                });
                            }
                            $("#table tbody").empty();
                            $("#table tbody").html(content);
                        }

                        var newText = "共" + totalCount + "条，" + "第" + pageNo + "页，" + "共" + pages + "页";

                        $("#summary").text(newText);
                    }

                });

            }

		</script>

		<script>

            function index(){

                pageNo = 1;

                var gameName = document.getElementById("gameType").value;
                var status = document.getElementById("status").value;

                loadData(gameName, status, pageNo, pageSize);

            }

			function last(){

                var gameName = document.getElementById("gameType").value;
                var status = document.getElementById("status").value;

				if(pageNo == 1){

					return false;

				} else{

					pageNo--;

					loadData(gameName, status, pageNo, pageSize);

				}

			}

			function next(){

                var gameName = document.getElementById("gameType").value;
                var status = document.getElementById("status").value;

				if(pageNo == pages){

					return false;

				} else{

					pageNo++;

                    loadData(gameName, status, pageNo, pageSize);

				}

			}

			function zuihou(){

				pageNo = pages;

                var gameName = document.getElementById("gameType").value;
                var status = document.getElementById("status").value;

                loadData(gameName, status, pageNo, pageSize);

			}
		</script>

	</body>

</html>