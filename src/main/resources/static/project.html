<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8"/>
	<title>运动管理信息系统</title>
	<meta name="keywords" content=""/>
	<meta name="description" content=""/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
	<link rel="stylesheet" href="assets/css/font-awesome.min.css"/>
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300"/>
	<link rel="stylesheet" href="assets/css/ace.min.css"/>
	<link rel="stylesheet" href="assets/css/ace-rtl.min.css"/>
	<link rel="stylesheet" href="assets/css/ace-skins.min.css"/>
	<script src="assets/js/ace-extra.min.js"></script>
	<script src="assets/js/myjs/my.js"></script>

	<style>
		.page-content .left img {
			width: 100%;
		}

		/*弹框*/
		html{height: 100%;}
		body{position: relative;height: 100%;}
		.dialogbody{position: absolute;z-index: 999;width: 100%;height: 100%;background: rgba(0,0,0,.8);top: 0;left: 0;display: none;}
		.dialogbox{position: absolute;display: block;width: 800px;height: 400px;background: #fff;border-radius: 15px;top: 0;left: 0;right: 0;bottom: 0;margin: auto;}
		.dialogbox .close{position: absolute;display: block;width: 50px;height: 50px;background: url(assets/images/Close.png) no-repeat 100% center;top: 20px;right: 20px;}


	</style>
</head>

<body>
<!--头部 Begin-->
<div class="navbar navbar-default" id="navbar">
	<script type="text/javascript">
        try {
            ace.settings.check('navbar', 'fixed')
        } catch (e) {
        }
	</script>

	<div class="navbar-container" id="navbar-container">
		<div class="navbar-header pull-left">
			<a href="#" class="navbar-brand">
				<small>
					<i class="icon-leaf"></i>
					运动管理信息系统
				</small>
			</a>
		</div>

		<div class="navbar-header pull-right" role="navigation">
			<ul class="nav ace-nav">
				<li class="light-blue">
					<a data-toggle="dropdown" href="#" class="dropdown-toggle">
						<img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo"/>
						<span class="user-info">
									<small>欢迎光临</small>
									<strong id="username"></strong>

								</span>

						<i class="icon-caret-down"></i>
					</a>

					<ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
						<li>
							<div class="col-sm-offset-2 col-sm-10">
								<i class="icon-off"></i>
								<button type="button" onclick="logout()" class="btn btn-default">退出</button>
							</div>
						</li>
					</ul>
				</li>
			</ul>
			<!-- /.ace-nav -->
		</div>
		<!-- /.navbar-header -->
	</div>
	<!-- /.container -->
</div>
<!--头部 End-->

<!--主体部分 Begin-->
<div class="main-container" id="main-container">
	<script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
	</script>

	<div class="main-container-inner">
		<a class="menu-toggler" id="menu-toggler" href="#">
			<span class="menu-text"></span>
		</a>
		<!--左侧导航 Begin-->
		<div class="sidebar" id="sidebar">
			<script type="text/javascript">
                try {
                    ace.settings.check('sidebar', 'fixed')
                } catch (e) {
                }
			</script>

			<ul class="nav nav-list" id="navlist">
				<li class="active navshowa">
					<a href="index.html">
						<i class="icon-dashboard"></i>
						<span class="menu-text">首页</span>
					</a>
				</li>

				<li class="active navshowa1">
					<a href="project.html">
						<i class="icon-text-width"></i>
						<span class="menu-text">赛事管理</span>
						<b class="arrow icon-angle-down"></b>
					</a>

					<ul class="submenu">
						<li class="navshowa21">
							<a href="sub_project.html">
								<i class="icon-double-angle-right"></i> 项目管理
							</a>
						</li>
					</ul>
				</li>

				<li class="active navshowa2">
					<a href="#" class="dropdown-toggle">
						<i class="icon-desktop"></i>
						<span class="menu-text">成绩查询</span>

						<b class="arrow icon-angle-down"></b>
					</a>

					<ul class="submenu">
						<li class="navshowa21">
							<a href="search_person.html">
								<i class="icon-double-angle-right"></i> 状态查询
							</a>
						</li>

						<!--<li class="navshowa22">
                            <a href="search_school.html">
                                <i class="icon-double-angle-right"></i> 团队查询
                            </a>
                        </li>-->
					</ul>
				</li>

				<li class="active navshowa3">
					<a href="#" class="dropdown-toggle">
						<i class="icon-list"></i>
						<span class="menu-text">报名管理</span>

						<b class="arrow icon-angle-down"></b>
					</a>

					<ul class="submenu">
						<li class="navshowa31">
							<a href="enter.html">
								<i class="icon-double-angle-right"></i> 报名
							</a>
						</li>

						<li class="navshowa32">
							<a href="enter_msg.html">
								<i class="icon-double-angle-right"></i> 报名信息查询
							</a>
						</li>
					</ul>
				</li>

				<li class="active navshowa4">
					<a href="addscore.html" class="dropdown-toggle">
						<i class="icon-edit"></i>
						<span class="menu-text">成绩录入</span>
					</a>
				</li>

				<li class="active navshowa5">
					<a href="usermsg.html" class="dropdown-toggle">
						<i class="icon-apple"></i>
						<span class="menu-text">权限管理</span>
					</a>
				</li>
			</ul>
			<!-- /.nav-list -->
		</div>
		<!--左侧导航 End-->

		<!--右侧内容 Begin-->
		<div class="main-content">
			<!--面包屑导航 Begin-->
			<div class="breadcrumbs" id="breadcrumbs">
				<script type="text/javascript">
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch(e) {}
				</script>

				<ul class="breadcrumb">
					<li>
						<i class="icon-home home-icon"></i>
						<a href="index.html" class="active">首页</a>
					</li>
				</ul>
			</div>
			<!--面包屑导航 End-->

			<!--内容 Begin-->
			<div class="page-content">
				<div class="row">
					<div class="col-xs-12">
						<h3 class="smaller lighter blue">
							运动会赛事管理
							<button class="btn btn-info dialogalert" style="float: right;">
								添加
								<i class="icon-print  align-top bigger-125 icon-on-right"></i>
							</button>
						</h3>

						<div class="table-responsive">
							<table id="table" class="table table-striped table-bordered table-hover">
								<thead>
								<tr>
									<th>序号</th>
									<th>比赛名称</th>
									<th>组办方</th>
									<th>起止日期</th>
									<th>导入名单</th>
									<th>修改</th>
									<th>删除</th>
								</tr>
								</thead>
								<tbody></tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<!--内容 End-->
		</div>
		<!--右侧内容 End-->



	</div>
</div>
<!--弹框 Begin-->
<div class="dialogbody dialogbody2">
	<div class="dialogbox">
		<span class="close"></span>
		<div class="row" style="padding-top: 50px;">
			<div class="col-xs-12">
				<!-- PAGE CONTENT BEGINS -->

				<form class="form-horizontal" role="form" id="newproject">
					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">比赛名称:</label>

						<div class="col-sm-6" >
							<input type="text" id="name" name="name" placeholder="" class="col-xs-10 col-sm-5" />
						</div>
					</div>

					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">组办方:</label>

						<div class="col-sm-6">
							<input type="text" id="organization" name="organization" placeholder="" class="col-xs-10 col-sm-5" />
						</div>
					</div>

					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-xs-3 control-label no-padding-right">起止日期</label>
						<div class="col-xs-6">
							<div class="input-daterange input-group">
								<input type=date data-date-format="yyyy-mm-dd"
									   class="input-sm form-control date-picker" name="activeStart" />
								<span class="input-group-addon"> <i
										class="fa fa-exchange"></i></span>
								<input type=date
									   data-date-format="yyyy-mm-dd"
									   class="input-sm form-control date-picker" name="activeFinish" />
							</div>
						</div>
					</div>

					<div class="space-4"></div>

					<div class="clearfix form-actions" style="margin-top: 70px;">
						<div class="col-md-offset-4 col-sm-offset-4 col-md-7 col-sm-7">
							<button class="btn btn-info btn_sub" type="button" id="addproject">
								<i class="icon-ok bigger-110"></i>
								提交
							</button>

							&nbsp; &nbsp; &nbsp;
							<button class="btn" type="reset">
								<i class="icon-undo bigger-110"></i>
								重置
							</button>
						</div>
					</div>

				</form>


			</div><!-- /.col -->
		</div>
	</div>
</div>
<!--弹框 End-->


<!--弹框 Begin-->
<div class="dialogbody modify">
	<div class="dialogbox" style="height: 352px">
		<span class="close"></span>
		<div class="row" style="padding-top: 50px;">
			<div class="col-xs-12">
				<!-- PAGE CONTENT BEGINS -->

				<form class="form-horizontal" role="form" id="modproject">
					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">比赛名称:</label>

						<div class="col-sm-6">
							<input type="text" id="modname" name="name" placeholder="" class="col-xs-10 col-sm-5" />
						</div>
					</div>

					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">组办方:</label>

						<div class="col-sm-6">
							<input type="text" id="modorganization" name="organization" placeholder="" class="col-xs-10 col-sm-5" />
						</div>
					</div>

					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-xs-3 control-label no-padding-right">起止日期</label>
						<div class="col-xs-6">
							<div class="input-daterange input-group">
								<input type=date data-date-format="yyyy-mm-dd" id="modActiveStart"
									   class="input-sm form-control date-picker" name="activeStart" />
								<span class="input-group-addon"> <i
										class="fa fa-exchange"></i></span>
								<input type=date id="modActiveFinish"
									   data-date-format="yyyy-mm-dd"
									   class="input-sm form-control date-picker" name="activeFinish" />
							</div>
						</div>
					</div>

					<div class="clearfix form-actions" style="margin-top: 120px;">
						<div class="col-md-offset-4 col-sm-offset-4 col-md-7 col-sm-7">
							<button class="btn btn-info btn_sub" type="button" id="modifyProject">
								<i class="icon-ok bigger-110"></i>
								提交
							</button>

							&nbsp; &nbsp; &nbsp;
							<button class="btn" type="reset">
								<i class="icon-undo bigger-110"></i>
								重置
							</button>
						</div>
					</div>

				</form>


			</div><!-- /.col -->
		</div>
	</div>
</div>



<div class="dialogbody importExcel">
	<div class="dialogbox">
		<span class="close"></span>
		<div class="row" style="padding-top: 50px;">
			<div class="col-xs-12">

				<form class="form-horizontal" role="form" id="importMembers" enctype="multipart/form-data">
					<div class="space-4"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right">赛事 </label>

						<div class="col-sm-6">
							<input type="text" id="gameName" name="gameName" placeholder="" class="col-xs-10 col-sm-5" />
						</div>
					</div>

					<div class="space-6"></div>

					<div class="form-group">
						<label class="col-sm-3 control-label no-padding-right" for="form-field-1">参赛名单 </label>

						<div class="col-sm-7">
							<input type="file" name="members" placeholder="" id="memberFile" class="col-xs-10 col-sm-8" />
						</div>
					</div>

					<div class="space-4"></div>

					<div class="clearfix form-actions" style="margin-top: 120px;">
						<div class="col-md-offset-4 col-sm-offset-4 col-md-7 col-sm-7">
							<button class="btn btn-info btn_sub" type="button" id="importMember">
								<i class="icon-ok bigger-110"></i>
								上传
							</button>

							&nbsp; &nbsp; &nbsp;
							<button class="btn" type="reset">
								<i class="icon-undo bigger-110"></i>
								重置
							</button>
						</div>
					</div>
				</form>

			</div>
		</div>
	</div>
</div>



<!--弹框 End-->
<script src="assets/js/jquery-2.0.3.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
<script src="assets/js/typeahead-bs2.min.js"></script>
<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="assets/js/jquery.slimscroll.min.js"></script>
<script src="assets/js/jquery.easy-pie-chart.min.js"></script>
<script src="assets/js/jquery.sparkline.min.js"></script>
<script src="assets/js/flot/jquery.flot.min.js"></script>
<script src="assets/js/flot/jquery.flot.pie.min.js"></script>
<script src="assets/js/flot/jquery.flot.resize.min.js"></script>
<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>
<script src="assets/js/myjs/index.js"></script>
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "script>");
    if ("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "script>");

    // 弹框
    $('.dialogalert').click(function(){
        $('.dialogbody2').css({'display':'block'})
    })
    $('.close').click(function(){
        $('.dialogbody').css({'display':'none'})
    })

</script>
<script type="text/javascript">
    //调用加载数据函数
    window.onload = showList();
    //添加项目
    $("#addproject").click(function(){
        // alert(111)
        console.log($('#name'));
        // alert("点击函数！");
        console.log($('#newproject').serialize());
        $.ajax({
            //几个参数需要注意一下
            type: "POST",//方法类型
            // contentType: "application/json",
            dataType: "json",//预期服务器返回的数据类型
            url: "/projectController/addProject",//url
            data: $('#newproject').serialize(),
            async: false,
            success: function (result) {

                if (result.httpStatus == 200) {
                    alert("添加项目成功！");
                    window.location.href = '/static/project.html'
                };
            },
            error: function () {
                alert("添加项目失败！");
            }
        });

    });

    //删除函数
    function doDel(sid,item){
        //执行ajax删除
        if(confirm("确定要删除吗？"))
            $.ajax({
                url:"/projectController/deleteProject",
                type:"POST",
                data:{id:sid},
                dataType:"json",
                success:function(res){
                    //判断是否删除成功
                    if(res.httpStatus ==200){
                        //alert(res.num);
                        // $(ob).parents("tr").remove();
                        window.onunload = showList();
                    }
                },
                error:function(){
                    alert('error');
                }
            });
    }


    function showList() {

        var datalist = [];
        $.ajax({
            type: "POST",
            contentType: "application/json",
            dataType: "json",
            data:{pageSize: 50,pageNum:1},
            url: "/projectController/adminRoleList",
            async: false,
            success: function (result) {
                var content = "";
                datalist=result.data.list;
                // console.log(datalist.toString());

                $.each(datalist,function(inex,item){
					var aa = item.durationTime.replace(/-/g, '.');
					var aa = aa.replace(/#/, '-');
                    content+="<tr>" +
                        "<td class='center'>"+item.id+"</td>" +
                        "<td>" + item.name+"</td>" +
                        "<td>"+item.organization+ "</td>" +
						"<td>"+aa+"</td>" +
                        "<td><div class='visible-md visible-lg hidden-sm hidden-xs action-buttons'>" +
                        "<a class='black '>" +
                        "<i class='icon-save bigger-130'></i></a></div></td>" +
                    //    "<td class='hidden-480'>" +
                        "<td><div class='visible-md visible-lg hidden-sm hidden-xs action-buttons'>" +
                        "<a class='green '>" +
                        "<i class='icon-pencil bigger-130'></i></a></div></td>" +
                        "<td><div class='visible-md visible-lg hidden-sm hidden-xs action-buttons '>" +
                        "<a class='red' onclick='doDel("+item.id+",this)'>" +
                        "<i class='icon-trash bigger-130'></i></a></div></td>" +
                        "</tr>";

                    $("#table tbody").empty();
                    $("#table tbody").html(content);
                });
            },
            error: function () {
                alert("异常！");
            }
        });
        // return datalist;
    }
    
    $('.black').click(function () {
        $('.dialogbody.importExcel').css({'display':'block'})
        var aname = $(this).parents('tr').children('td').eq(1).text();
        $('#gameName').val(aname);
        $('#importMember').click(function () {
            var uploadFile = $("#memberFile").val();
            var gameType = $("#gameName").val();
            if(gameType == null || gameType == ''){
                alert("请选择赛事");
            }
            if (uploadFile == '') {
                alert("请择excel,再上传");
            } else if (uploadFile.lastIndexOf(".xls") < 0 && uploadFile.lastIndexOf(".xlsx") < 0
                && uploadFile.lastIndexOf(".xlsm") < 0) {//可判断以.xls和.xlsx结尾的excel
                alert("只能上传Excel文件");
            }else{
                var formData = new FormData();
                var file = $("#memberFile")[0].files[0];
                //此处将所要传递的数据append到formData中
                formData.append("fileinfo", file);
                formData.append("gameType", gameType);
                $.ajax({
                    //几个参数需要注意一下
                    type: "POST",//方法类型
                    // contentType: "application/json",
                    dataType: "json",//预期服务器返回的数据类型
                    url: "/scoreAddController/importMember",//url
                    data:formData,
                    async: false,
                    processData: false,       //必不可缺
                    contentType: false,       //必不可缺
                    success: function (result) {
                        if (result) {
                            alert("导入成功！");
                            window.location.href = "/static/project.html";
                        };
                    },
                    error: function () {
                        alert("异常！");
                        //window.location.href = "/static/addscore.html";
                    }
                });
            }
        })
    })

    // 编辑
    $('.green').click(function () {
        $('.dialogbody.modify').css({'display':'block'})
        var aid = $(this).parents('tr').children('td.center').text();
        var aname = $(this).parents('tr').children('td').eq(1).text();
        var aorganization = $(this).parents('tr').children('td').eq(2).text();
        var durationTime = $(this).parents('tr').children('td').eq(3).text();
        durationTime = durationTime.replace(/-/, '#');
        durationTime = durationTime.replace(/\./g, '-');
        var strArr = durationTime.split("#");
        var obj = $(this).parents('tr');
        $('#modname').val(aname);
        $('#modorganization').val(aorganization);
		$('#modActiveStart').val(strArr[0]);
		$('#modActiveFinish').val(strArr[1]);
        $('#modifyProject').click(function () {
            var newName = $('#modname').val();
            var newOrganization = $('#modorganization').val();
            var newActiveStart = $('#modActiveStart').val();
            var newActiveFinish = $('#modActiveFinish').val();
            $.ajax({
                type: "post",
                dataType: "json",
                async:'false',
                url: "/projectController/modifyProject",
                data:{id:aid,name:newName,organization:newOrganization},
                success:function (res) {
                    $('.dialogbody').css({'display':'none'})
                    window.location.href = '/static/project.html'
                }
            })
        })
    })

</script>

</body>

</html>